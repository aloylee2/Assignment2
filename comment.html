<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check for Damages</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Container for image previews */
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        /* Individual image preview styles */
        .image-preview-container img {
            max-width: 100px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <main>
        <!-- =================start Logo========================= -->
        <div class="logo-navbar" id="home">
            <a href="#home">
                <img src="image/logo(withoutbackground).png" width="200" height="200" alt="Azoom Car Rental Logo">
            </a>
        </div>
        <!-- =================End Logo========================= -->
        
        <!-- =================Start navbar========================= -->
        <nav class="navbar">
            <ul class="top-nav-uil">
                <div class="navbar-middle">
                    <li class="top-nav-li"><a href="#home">Home</a></li>
                    <li class="top-nav-li"><a href="returnedpageadmin.html">Returned car</a></li>
                    <li class="top-nav-li"><a href="display_report.html">View car report</a></li>
                </div>
            </ul>
        </nav>
        
        <h1>Check for Damages to the Car</h1>
        <form id="commentForm">
            <textarea id="additionalComment" placeholder="Add your comment here" required></textarea>
            <input type="file" id="imageUpload" multiple accept="image/*" required>
            
            <!-- Image preview container moved above the price input -->
            <div class="image-preview-container" id="imagePreview"></div> <!-- Container for image previews -->
            
            <input type="number" id="price" placeholder="Enter price" required min="0" step="0.01">
            <button type="submit">Submit</button>
        </form>
    </main>
    <footer>
        <div class="footer-leftside">
            <img src="image/logo(withoutbackground).png" width="200" height="200" alt="Azoom Car Rental Logo">
            <h2 class="footer-company-name">Azoom car rental Â© 2024</h2>
        </div>
        
        <div class="footer-middle">
            <div>
                <i class="fa fa-map-marker"></i>
                <p><span>463 Clementi Rd, Singapore 599494</span></p>
            </div>
            <div>
                <i class="fa fa-phone"></i>
                <p>+65 6248 9777</p>
            </div>
            <div>
                <i class="fa fa-envelope"></i>
                <p><a href="mailto:support@company.com">support@Azoomcarrental.com</a></p>
            </div>
        </div>
        
        <div class="footer-rightside">
            <p class="footer-company-about">
                <span>About the company</span>
                Lorem ipsum dolor sit amet, consectateur adispicing elit. Fusce euismod convallis velit, eu auctor lacus vehicula sit amet.
            </p>
            <div class="footer-icons">
                <a href="https://www.facebook.com/"><i class="fa fa-facebook"></i></a>
                <a href="https://www.twitter.com/"><i class="fa fa-twitter"></i></a>
                <a href="https://www.instagram.com/"><i class="fa fa-instagram"></i></a>
            </div>
        </div>
    </footer>
    <script src="script.js"></script>
    <script>
        const commentForm = document.getElementById("commentForm");
        const additionalComment = document.getElementById("additionalComment");
        const priceInput = document.getElementById("price");
        const imageUpload = document.getElementById("imageUpload");
        const imagePreview = document.getElementById("imagePreview");

        const selectedUser = JSON.parse(localStorage.getItem("selectedUser"));

        imageUpload.addEventListener("change", function () {
            // Clear previous previews
            imagePreview.innerHTML = '';

            const files = imageUpload.files;
            for (let i = 0; i < files.length; i++) {
                const img = document.createElement("img");
                img.src = URL.createObjectURL(files[i]);
                img.alt = "Image preview";
                imagePreview.appendChild(img);
            }
        });

        commentForm.addEventListener("submit", function (e) {
            e.preventDefault();

            const commentData = {
                username: selectedUser.username,
                originalComment: selectedUser.comment,
                additionalComment: additionalComment.value,
                price: parseFloat(priceInput.value), // Get the price
                images: []
            };

            const files = imageUpload.files;
            for (let i = 0; i < files.length; i++) {
                commentData.images.push(URL.createObjectURL(files[i]));
            }

            // Create the text file content
            const reportContent = `
                Check for Damages to the Car Report
                ------------------------------------
                Username: ${commentData.username}
                Original Comment: ${commentData.originalComment}
                Additional Comment: ${commentData.additionalComment}
                Price: $${commentData.price.toFixed(2)}
                Images: ${commentData.images.join(', ')}
            `.trim();

            // Create a Blob and trigger download
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'check_for_damages_report.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url); // Clean up

            // Simulate charging the credit card (placeholder)
            alert(`Charging $${commentData.price.toFixed(2)} to the customer credit card.`);

            console.log(commentData);
            commentForm.reset();
            imagePreview.innerHTML = ''; // Clear the image previews
            alert("Comment, images, and price submitted! Report downloaded.");
            window.location.href = 'returnedpageadmin.html';
        });
    </script>
</body>
</html>
